pipeline{
  agent any
  
  environment {
        FILE_LOCATION = 'example-voting-app/vote/' 
    }


  stages{
    
    stage('buildDockerImage'){
      steps{
        sh ''' 
          cd ${FILE_LOCATION}
          docker build -t najamarcana/voteapp . 
        '''
      }
    }
    
    stage('pushingImage'){
      steps{
        withCredentials([usernamePassword(credentialsId: 'dockerhub-creds', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]) {
          sh """
              echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin
              docker push najamarcana/voteapp:latest
          """
         }
      }
    }
    
    stage('runDockerImage'){
      steps{
        sh ' docker run -p 5000:80 najamarcana/voteapp '
      }
    }
    
    
    
  }
}
